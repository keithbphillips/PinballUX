#!/usr/bin/make -f

%:
	dh $@

override_dh_auto_build:
	# No build step needed

override_dh_auto_install:
	# Install main application
	install -d debian/pinballux/opt/pinballux

	# Copy pinballux directory contents (not the directory itself), excluding large data files
	rsync -av --exclude='data/media/videos' \
	          --exclude='data/media/audio' \
	          --exclude='data/media/images/table' \
	          --exclude='data/media/images/backglass' \
	          --exclude='data/media/images/wheel' \
	          --exclude='data/media/images/dmd' \
	          --exclude='data/media/images/topper' \
	          --exclude='data/media/packs' \
	          --exclude='data/packs' \
	          --exclude='data/tables' \
	          --exclude='data/roms' \
	          --exclude='__pycache__' \
	          --exclude='*.pyc' \
	          pinballux/ debian/pinballux/opt/pinballux/

	cp setup_gui.py debian/pinballux/opt/pinballux/
	cp table_manager.py debian/pinballux/opt/pinballux/
	cp run_pinballux.py debian/pinballux/opt/pinballux/
	cp requirements.txt debian/pinballux/opt/pinballux/
	cp README.md debian/pinballux/opt/pinballux/

	# Install wrapper scripts
	install -d debian/pinballux/usr/bin
	install -m 755 debian/pinballux-setup debian/pinballux/usr/bin/pinballux-setup
	install -m 755 debian/pinballux-manager debian/pinballux/usr/bin/pinballux-manager
	install -m 755 debian/pinballux-run debian/pinballux/usr/bin/pinballux

	# Install desktop entries
	install -d debian/pinballux/usr/share/applications
	install -m 644 debian/pinballux.desktop debian/pinballux/usr/share/applications/
	install -m 644 debian/pinballux-setup.desktop debian/pinballux/usr/share/applications/
	install -m 644 debian/pinballux-manager.desktop debian/pinballux/usr/share/applications/

	# Install icons
	install -d debian/pinballux/usr/share/pixmaps
	install -m 644 pinballux/data/media/images/ui/PinballUX.png debian/pinballux/usr/share/pixmaps/pinballux.png
	install -m 644 pinballux/data/media/images/ui/TableManager.png debian/pinballux/usr/share/pixmaps/pinballux-manager.png

	# Create data directories with proper structure (at /opt/pinballux/data/)
	install -d debian/pinballux/opt/pinballux/data/tables
	install -d debian/pinballux/opt/pinballux/data/roms

	# Create vpinball directory for user installation
	install -d debian/pinballux/opt/pinballux/vpinball
	install -d debian/pinballux/opt/pinballux/data/media/videos/table
	install -d debian/pinballux/opt/pinballux/data/media/videos/backglass
	install -d debian/pinballux/opt/pinballux/data/media/videos/dmd
	install -d debian/pinballux/opt/pinballux/data/media/videos/real_dmd
	install -d debian/pinballux/opt/pinballux/data/media/videos/real_dmd_color
	install -d debian/pinballux/opt/pinballux/data/media/videos/topper
	install -d debian/pinballux/opt/pinballux/data/media/images/table
	install -d debian/pinballux/opt/pinballux/data/media/images/backglass
	install -d debian/pinballux/opt/pinballux/data/media/images/wheel
	install -d debian/pinballux/opt/pinballux/data/media/images/dmd
	install -d debian/pinballux/opt/pinballux/data/media/images/topper
	install -d debian/pinballux/opt/pinballux/data/media/audio/table
	install -d debian/pinballux/opt/pinballux/data/media/audio/launch
	install -d debian/pinballux/opt/pinballux/data/media/audio/ui
	install -d debian/pinballux/opt/pinballux/data/media/packs

override_dh_fixperms:
	dh_fixperms
	# Make data and vpinball directories writable by all users
	chmod -R 777 debian/pinballux/opt/pinballux/data || true
	chmod -R 777 debian/pinballux/opt/pinballux/vpinball || true

override_dh_auto_test:
	# Skip tests

override_dh_auto_clean:
	# Nothing to clean
